<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏπºÎ°úÎ¶¨ Í≥ÑÏÇ∞Í∏∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@2.3/NanumSquareNeo.woff');
        
        body {
            font-family: 'NanumSquareNeo', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .upload-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .upload-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .upload-btn {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .upload-btn:active {
            transform: translateY(0);
        }

        .image-preview {
            width: 100%;
            max-width: 400px;
            margin: 0 auto 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }

        .image-preview img {
            width: 100%;
            height: auto;
            display: block;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            display: none;
        }

        .results h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .sample-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 15px;
            border: 2px dashed #667eea;
        }

        .sample-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
        }

        .sample-gallery {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .sample-item {
            background: white;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .sample-item:hover {
            transform: translateY(-2px);
        }

        .sample-image {
            margin-bottom: 10px;
        }

        .sample-image img {
            width: 100%;
            max-width: 120px;
            border-radius: 8px;
        }

        .sample-info {
            text-align: center;
        }

        .sample-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .sample-calories {
            color: #667eea;
            font-weight: 500;
            font-size: 0.85rem;
        }

        .sample-note {
            text-align: center;
            color: #667eea;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .calculation-process {
            background: #f0f4ff;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .calculation-process h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .calculation-steps {
            list-style: none;
            padding: 0;
        }

        .calculation-steps li {
            background: white;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 3px solid #667eea;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .calculation-steps li::before {
            content: "‚Ä¢ ";
            color: #667eea;
            font-weight: 600;
            margin-right: 8px;
        }

        .exercise-recommendations {
            background: #f0f8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #10b981;
        }

        .exercise-recommendations h3 {
            color: #10b981;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .exercise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .exercise-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid #10b981;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .exercise-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .exercise-info {
            flex: 1;
        }

        .exercise-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 3px;
            font-size: 0.9rem;
        }

        .exercise-duration {
            color: #10b981;
            font-weight: 500;
            font-size: 0.8rem;
        }

        .food-item {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
        }

        .food-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .food-calories {
            color: #667eea;
            font-weight: 500;
        }

        .total-calories {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-btn {
            background: #10b981;
            color: white;
        }

        .copy-btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .reset-btn {
            background: #6b7280;
            color: white;
        }

        .reset-btn:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }

        .error {
            background: #fee2e2;
            color: #dc2626;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            display: none;
        }

        input[type="file"] {
            display: none;
        }

                     @media (max-width: 480px) {
             .container {
                 padding: 15px;
             }
             
             .header h1 {
                 font-size: 2rem;
             }
             
             .upload-section {
                 padding: 20px;
             }
             
             .upload-buttons {
                 flex-direction: column;
             }
             
             .results {
                 padding: 20px;
             }

             .sample-gallery {
                 grid-template-columns: 1fr 1fr;
             }

             .exercise-grid {
                 grid-template-columns: 1fr;
             }
         }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è ÏπºÎ°úÎ¶¨ Í≥ÑÏÇ∞Í∏∞</h1>
            <p>ÏÇ¨ÏßÑÏúºÎ°ú Í∞ÑÌé∏ÌïòÍ≤å ÏπºÎ°úÎ¶¨Î•º Í≥ÑÏÇ∞ÌïòÏÑ∏Ïöî</p>
        </div>

        <div class="upload-section">
            <div class="upload-buttons">
                <button class="upload-btn" onclick="openCamera()">
                    üì∑ ÏÇ¨ÏßÑ Ï¥¨ÏòÅ
                </button>
                <button class="upload-btn" onclick="openGallery()">
                    üìÅ Í∞§Îü¨Î¶¨ ÏÑ†ÌÉù
                </button>
            </div>

            <input type="file" id="cameraInput" accept="image/*" capture="environment" onchange="handleImageUpload(event)">
            <input type="file" id="galleryInput" accept="image/*" onchange="handleImageUpload(event)">

            <!-- ÏÉòÌîå Ïù¥ÎØ∏ÏßÄ Î∞è Í≤∞Í≥º -->
            <div class="sample-section" id="sampleSection">
                <h3>üìã ÏÇ¨Ïö©Î≤ï ÏòàÏãú</h3>
                <div class="sample-gallery">
                    <!-- ÍπÄÏπòÏ∞åÍ∞ú ÏÉòÌîå -->
                    <div class="sample-item">
                        <div class="sample-image">
                            <img src="images/menu1.jpg" alt="ÍπÄÏπòÏ∞åÍ∞ú">
                        </div>
                        <div class="sample-info">
                            <div class="sample-title">üç≤ ÍπÄÏπòÏ∞åÍ∞ú + Î∞•</div>
                            <div class="sample-calories">530kcal</div>
                        </div>
                    </div>
                    
                    <!-- Ïä§ÌååÍ≤åÌã∞ ÏÉòÌîå -->
                    <div class="sample-item">
                        <div class="sample-image">
                            <img src="images/menu2.jpg" alt="Ïä§ÌååÍ≤åÌã∞">
                        </div>
                        <div class="sample-info">
                            <div class="sample-title">üçù Ïä§ÌååÍ≤åÌã∞</div>
                            <div class="sample-calories">420kcal</div>
                        </div>
                    </div>
                    
                    <!-- ÌñÑÎ≤ÑÍ±∞ ÏÉòÌîå -->
                    <div class="sample-item">
                        <div class="sample-image">
                            <img src="images/menu3.jpg" alt="ÌñÑÎ≤ÑÍ±∞">
                        </div>
                        <div class="sample-info">
                            <div class="sample-title">üçî ÌñÑÎ≤ÑÍ±∞</div>
                            <div class="sample-calories">680kcal</div>
                        </div>
                    </div>

                    <!-- ÏÉåÎìúÏúÑÏπò ÏÉòÌîå -->
                    <div class="sample-item">
                        <div class="sample-image">
                            <img src="images/menu4.jpg" alt="ÏÉåÎìúÏúÑÏπò">
                        </div>
                        <div class="sample-info">
                            <div class="sample-title">ü•™ ÏÉåÎìúÏúÑÏπò</div>
                            <div class="sample-calories">350kcal</div>
                        </div>
                    </div>
                </div>
                <div class="sample-note">üì± ÏúÑÏôÄ Í∞ôÏùÄ ÏùåÏãù ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ ÏπºÎ°úÎ¶¨Î•º ÏûêÎèôÏúºÎ°ú Í≥ÑÏÇ∞Ìï¥ÎìúÎ¶ΩÎãàÎã§!</div>
            </div>

            <div class="image-preview" id="imagePreview">
                <img id="previewImg" src="" alt="ÎØ∏Î¶¨Î≥¥Í∏∞">
            </div>

            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>Ïù¥ÎØ∏ÏßÄÎ•º Î∂ÑÏÑù Ï§ëÏûÖÎãàÎã§...</p>
            </div>

            <div class="error" id="error"></div>
        </div>

        <div class="results" id="results">
            <h2>üìä Ïù∏Ïãù Í≤∞Í≥º</h2>
            <div id="foodList"></div>
            
            <!-- Í≥ÑÏÇ∞ Í≥ºÏ†ï ÌëúÏãú -->
            <div class="calculation-process" id="calculationProcess">
                <h3>üßÆ ÏπºÎ°úÎ¶¨ Í≥ÑÏÇ∞ Í≥ºÏ†ï</h3>
                <ul class="calculation-steps" id="calculationSteps"></ul>
            </div>

            <!-- Ïö¥ÎèôÎüâ Ï†úÏãú -->
            <div class="exercise-recommendations" id="exerciseRecommendations">
                <h3>üèÉ‚Äç‚ôÇÔ∏è ÏÜåÎ™®ÌïòÍ∏∞ ÏúÑÌïú Ïö¥ÎèôÎüâ</h3>
                <div class="exercise-grid" id="exerciseGrid"></div>
            </div>
            
            <div class="total-calories" id="totalCalories"></div>
            <div class="action-buttons">
                <button class="action-btn copy-btn" onclick="copyResults()">üìã Í≤∞Í≥º Î≥µÏÇ¨</button>
                <button class="action-btn reset-btn" onclick="resetApp()">üîÑ Îã§Ïãú Ï¥¨ÏòÅ</button>
            </div>
        </div>
    </div>

    <script>
        const GEMINI_API_KEY = 'AIzaSyAuIw9_z2inrQvqZHgvnfpr3gSso0C8LdU';
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;

        let currentResults = null;

        // Ïö¥ÎèôÎ≥Ñ ÏπºÎ°úÎ¶¨ ÏÜåÎ™®Îüâ (kcal/Î∂Ñ, 70kg ÏÑ±Ïù∏ Í∏∞Ï§Ä)
        const exerciseData = [
            { name: 'Îã¨Î¶¨Í∏∞', icon: 'üèÉ‚Äç‚ôÇÔ∏è', caloriesPerMinute: 10 },
            { name: 'ÏûêÏ†ÑÍ±∞ ÌÉÄÍ∏∞', icon: 'üö¥‚Äç‚ôÇÔ∏è', caloriesPerMinute: 8 },
            { name: 'Îì±ÏÇ∞', icon: 'ü•æ', caloriesPerMinute: 6 },
            { name: 'ÏàòÏòÅ', icon: 'üèä‚Äç‚ôÇÔ∏è', caloriesPerMinute: 9 },
            { name: 'Í±∑Í∏∞', icon: 'üö∂‚Äç‚ôÇÔ∏è', caloriesPerMinute: 4 },
            { name: 'Í≥ÑÎã® Ïò§Î•¥Í∏∞', icon: 'ü™ú', caloriesPerMinute: 12 }
        ];

        function calculateExercise(calories) {
            return exerciseData.map(exercise => {
                const minutes = Math.round(calories / exercise.caloriesPerMinute);
                let duration;
                
                if (minutes >= 60) {
                    const hours = Math.floor(minutes / 60);
                    const remainingMinutes = minutes % 60;
                    duration = remainingMinutes > 0 ? `${hours}ÏãúÍ∞Ñ ${remainingMinutes}Î∂Ñ` : `${hours}ÏãúÍ∞Ñ`;
                } else {
                    duration = `${minutes}Î∂Ñ`;
                }
                
                return {
                    ...exercise,
                    duration: duration,
                    minutes: minutes
                };
            });
        }

        function openCamera() {
            document.getElementById('cameraInput').click();
        }

        function openGallery() {
            document.getElementById('galleryInput').click();
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewImg = document.getElementById('previewImg');
                const imagePreview = document.getElementById('imagePreview');
                
                previewImg.src = e.target.result;
                imagePreview.style.display = 'block';
                
                // Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù ÏãúÏûë
                analyzeImage(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        async function analyzeImage(imageDataUrl) {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const results = document.getElementById('results');
            
            // UI Ï¥àÍ∏∞Ìôî
            loading.style.display = 'block';
            error.style.display = 'none';
            results.style.display = 'none';

            try {
                // base64 Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú
                const base64Data = imageDataUrl.split(',')[1];
                
                                 const requestBody = {
                     contents: [{
                         parts: [
                             {
                                 text: `Ïù¥ Ïù¥ÎØ∏ÏßÄÏóê ÏûàÎäî ÏùåÏãùÏùÑ Î∂ÑÏÑùÌïòÍ≥† Îã§Ïùå ÌòïÏãùÏúºÎ°ú Ï†ïÌôïÌûà ÏùëÎãµÌï¥Ï£ºÏÑ∏Ïöî:

ÏùåÏãù1: ÏùåÏãùÎ™Ö - ÏòàÏÉÅÎüâ - ÏπºÎ°úÎ¶¨
ÏùåÏãù2: ÏùåÏãùÎ™Ö - ÏòàÏÉÅÎüâ - ÏπºÎ°úÎ¶¨
...
Ï¥ù ÏπºÎ°úÎ¶¨: XXXkcal

Í≥ÑÏÇ∞Í≥ºÏ†ï:
- ÏùåÏãù1 ÏπºÎ°úÎ¶¨ Í≥ÑÏÇ∞ Í∑ºÍ±∞ (Ïòà: ÍπÄÏπòÏ∞åÍ∞ú 1Ïù∏Î∂Ñ Í∏∞Ï§Ä ÏùºÎ∞òÏ†Å ÏπºÎ°úÎ¶¨)
- ÏùåÏãù2 ÏπºÎ°úÎ¶¨ Í≥ÑÏÇ∞ Í∑ºÍ±∞
- Ï¥ùÌï© Í≥ÑÏÇ∞ Í≥ºÏ†ï

ÏòàÏãú:
ÍπÄÏπòÏ∞åÍ∞ú: ÍπÄÏπòÏ∞åÍ∞ú - 1Ïù∏Î∂Ñ - 320kcal
Î∞•: Î∞• - 1Í≥µÍ∏∞ - 210kcal
Ï¥ù ÏπºÎ°úÎ¶¨: 530kcal

Í≥ÑÏÇ∞Í≥ºÏ†ï:
- ÍπÄÏπòÏ∞åÍ∞ú 1Ïù∏Î∂Ñ: ÏùºÎ∞òÏ†ÅÏúºÎ°ú Íµ≠Î¨ºÌè¨Ìï® 300-350kcal Î≤îÏúÑ, Ï§ëÍ∞ÑÍ∞í 320kcal Ï†ÅÏö©
- Î∞• 1Í≥µÍ∏∞: ÌëúÏ§Ä Í≥µÍ∏∞(150g) Í∏∞Ï§Ä ÏïΩ 210kcal
- Ï¥ùÌï©: 320kcal + 210kcal = 530kcal

ÎßåÏïΩ ÏùåÏãùÏù¥ Ïù∏ÏãùÎêòÏßÄ ÏïäÏúºÎ©¥ "ÏùåÏãùÏùÑ Ïù∏ÏãùÌï† Ïàò ÏóÜÏäµÎãàÎã§"ÎùºÍ≥† ÏùëÎãµÌï¥Ï£ºÏÑ∏Ïöî.`
                             },
                            {
                                inline_data: {
                                    mime_type: "image/jpeg",
                                    data: base64Data
                                }
                            }
                        ]
                    }]
                };

                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`API Ìò∏Ï∂ú Ïã§Ìå®: ${response.status}`);
                }

                const data = await response.json();
                const analysisResult = data.candidates[0].content.parts[0].text;
                
                displayResults(analysisResult);
                
            } catch (err) {
                console.error('Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ïò§Î•ò:', err);
                showError('Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
            } finally {
                loading.style.display = 'none';
            }
        }

                 function displayResults(analysisText) {
             if (analysisText.includes('ÏùåÏãùÏùÑ Ïù∏ÏãùÌï† Ïàò ÏóÜÏäµÎãàÎã§')) {
                 showError('ÏùåÏãùÏùÑ Ïù∏ÏãùÌï† Ïàò ÏóÜÏäµÎãàÎã§. Îã§Î•∏ Ïù¥ÎØ∏ÏßÄÎ°ú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                 return;
             }

             const lines = analysisText.split('\n').filter(line => line.trim());
             const foodItems = [];
             const calculationSteps = [];
             let totalCalories = 0;
             let isCalculationSection = false;

             lines.forEach(line => {
                 if (line.includes('Í≥ÑÏÇ∞Í≥ºÏ†ï:')) {
                     isCalculationSection = true;
                 } else if (isCalculationSection && line.startsWith('-')) {
                     // Í≥ÑÏÇ∞ Í≥ºÏ†ï Ìï≠Î™©
                     calculationSteps.push(line.substring(1).trim());
                 } else if (line.includes('Ï¥ù ÏπºÎ°úÎ¶¨:') || line.includes('Ï¥ùÏπºÎ°úÎ¶¨:')) {
                     const calorieMatch = line.match(/(\d+)kcal/);
                     if (calorieMatch) {
                         totalCalories = parseInt(calorieMatch[1]);
                     }
                 } else if (line.includes('-') && line.includes('kcal') && !isCalculationSection) {
                     // ÏùåÏãù Ìï≠Î™© ÌååÏã±
                     const parts = line.split(':');
                     if (parts.length >= 2) {
                         const foodName = parts[0].trim();
                         const details = parts[1].trim();
                         const calorieMatch = details.match(/(\d+)kcal/);
                         const calories = calorieMatch ? parseInt(calorieMatch[1]) : 0;
                         
                         foodItems.push({
                             name: foodName,
                             details: details,
                             calories: calories
                         });
                     }
                 }
             });

             // Ï¥ù ÏπºÎ°úÎ¶¨Í∞Ä 0Ïù¥Î©¥ Í∞úÎ≥Ñ ÏπºÎ°úÎ¶¨ Ìï©Í≥ÑÎ°ú Í≥ÑÏÇ∞
             if (totalCalories === 0) {
                 totalCalories = foodItems.reduce((sum, item) => sum + item.calories, 0);
             }

             currentResults = {
                 foods: foodItems,
                 total: totalCalories,
                 calculationSteps: calculationSteps,
                 originalText: analysisText
             };

             // UI ÏóÖÎç∞Ïù¥Ìä∏
             const foodList = document.getElementById('foodList');
             const totalCaloriesEl = document.getElementById('totalCalories');
             const calculationStepsEl = document.getElementById('calculationSteps');
             const exerciseGrid = document.getElementById('exerciseGrid');
             const results = document.getElementById('results');
             const sampleSection = document.getElementById('sampleSection');

             // ÏÉòÌîå ÏÑπÏÖò Ïà®Í∏∞Í∏∞
             sampleSection.style.display = 'none';

             foodList.innerHTML = '';
             calculationStepsEl.innerHTML = '';
             exerciseGrid.innerHTML = '';
             
             if (foodItems.length === 0) {
                 foodList.innerHTML = '<div class="food-item"><div class="food-name">Î∂ÑÏÑù Í≤∞Í≥ºÎ•º ÌååÏã±Ìï† Ïàò ÏóÜÏäµÎãàÎã§</div><div class="food-calories">ÏõêÎ≥∏: ' + analysisText + '</div></div>';
             } else {
                 foodItems.forEach(food => {
                     const foodItem = document.createElement('div');
                     foodItem.className = 'food-item';
                     foodItem.innerHTML = `
                         <div class="food-name">${food.name}</div>
                         <div class="food-calories">${food.details}</div>
                     `;
                     foodList.appendChild(foodItem);
                 });
             }

             // Í≥ÑÏÇ∞ Í≥ºÏ†ï ÌëúÏãú
             if (calculationSteps.length > 0) {
                 calculationSteps.forEach(step => {
                     const li = document.createElement('li');
                     li.textContent = step;
                     calculationStepsEl.appendChild(li);
                 });
             } else {
                 // Í∏∞Î≥∏ Í≥ÑÏÇ∞ Í≥ºÏ†ï ÏÉùÏÑ±
                 if (foodItems.length > 0) {
                     foodItems.forEach(food => {
                         const li = document.createElement('li');
                         li.textContent = `${food.name}: ${food.details}`;
                         calculationStepsEl.appendChild(li);
                     });
                     
                     const totalLi = document.createElement('li');
                     const individualCalories = foodItems.map(food => `${food.calories}kcal`).join(' + ');
                     totalLi.textContent = `Ï¥ùÌï©: ${individualCalories} = ${totalCalories}kcal`;
                     calculationStepsEl.appendChild(totalLi);
                 }
             }

             // Ïö¥ÎèôÎüâ Í≥ÑÏÇ∞ Î∞è ÌëúÏãú
             if (totalCalories > 0) {
                 const exercises = calculateExercise(totalCalories);
                 exercises.forEach(exercise => {
                     const exerciseItem = document.createElement('div');
                     exerciseItem.className = 'exercise-item';
                     exerciseItem.innerHTML = `
                         <div class="exercise-icon">${exercise.icon}</div>
                         <div class="exercise-info">
                             <div class="exercise-name">${exercise.name}</div>
                             <div class="exercise-duration">${exercise.duration}</div>
                         </div>
                     `;
                     exerciseGrid.appendChild(exerciseItem);
                 });
             }

             totalCaloriesEl.textContent = `Ï¥ù ÏòàÏÉÅ ÏπºÎ°úÎ¶¨: ${totalCalories}kcal`;
             results.style.display = 'block';
         }

        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.style.display = 'block';
        }

                 function copyResults() {
             if (!currentResults) return;

             let copyText = 'üçΩÔ∏è ÏπºÎ°úÎ¶¨ Í≥ÑÏÇ∞ Í≤∞Í≥º\n\n';
             
             copyText += 'üìä Ïù∏ÏãùÎêú ÏùåÏãù:\n';
             currentResults.foods.forEach(food => {
                 copyText += `‚Ä¢ ${food.name}: ${food.details}\n`;
             });
             
             if (currentResults.calculationSteps && currentResults.calculationSteps.length > 0) {
                 copyText += '\nüßÆ Í≥ÑÏÇ∞ Í≥ºÏ†ï:\n';
                 currentResults.calculationSteps.forEach(step => {
                     copyText += `‚Ä¢ ${step}\n`;
                 });
             }
             
             copyText += `\nÏ¥ù ÏòàÏÉÅ ÏπºÎ°úÎ¶¨: ${currentResults.total}kcal`;

             // Ïö¥ÎèôÎüâ Ï†ïÎ≥¥ Ï∂îÍ∞Ä
             if (currentResults.total > 0) {
                 copyText += '\n\nüèÉ‚Äç‚ôÇÔ∏è ÏÜåÎ™®ÌïòÍ∏∞ ÏúÑÌïú Ïö¥ÎèôÎüâ:\n';
                 const exercises = calculateExercise(currentResults.total);
                 exercises.forEach(exercise => {
                     copyText += `‚Ä¢ ${exercise.name}: ${exercise.duration}\n`;
                 });
             }

            navigator.clipboard.writeText(copyText).then(() => {
                const copyBtn = document.querySelector('.copy-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ Î≥µÏÇ¨Îê®!';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            }).catch(() => {
                // ÌÅ¥Î¶ΩÎ≥¥Îìú APIÍ∞Ä ÏßÄÏõêÎêòÏßÄ ÏïäÎäî Í≤ΩÏö∞
                const textArea = document.createElement('textarea');
                textArea.value = copyText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const copyBtn = document.querySelector('.copy-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ Î≥µÏÇ¨Îê®!';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            });
        }

                 function resetApp() {
             // Î™®Îì† UI Ï¥àÍ∏∞Ìôî
             document.getElementById('imagePreview').style.display = 'none';
             document.getElementById('loading').style.display = 'none';
             document.getElementById('error').style.display = 'none';
             document.getElementById('results').style.display = 'none';
             document.getElementById('sampleSection').style.display = 'block';
             document.getElementById('cameraInput').value = '';
             document.getElementById('galleryInput').value = '';
             currentResults = null;
         }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        window.addEventListener('load', () => {
            resetApp();
        });
    </script>
</body>
</html> 